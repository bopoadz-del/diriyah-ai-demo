<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Diriyah Brain AI</title>
  <style>
    body { margin: 0; font-family: Arial, sans-serif; background: #f5f2e9; color: #333; display: flex; height: 100vh; }
    .sidebar { width: 220px; background: #eee3d1; padding: 15px; display: flex; flex-direction: column; }
    .sidebar h2 { font-size: 1.2rem; margin-top: 0; }
    .sidebar button { background: none; border: none; text-align: left; padding: 10px; margin: 3px 0; cursor: pointer; border-radius: 6px; }
    .sidebar button:hover { background: #d2b48c; color: white; }
    .chat-area { flex: 1; display: flex; flex-direction: column; }
    .chat-header { background: #d2b48c; color: white; padding: 15px; font-size: 1.3rem; font-weight: bold; text-align: center; }
    .messages { flex: 1; padding: 20px; overflow-y: auto; }
    .bubble { max-width: 70%; padding: 10px 15px; margin: 8px 0; border-radius: 12px; line-height: 1.4; }
    .user-bubble { background: #c1d3ff; align-self: flex-end; }
    .ai-bubble { background: #f0e6d2; align-self: flex-start; }
    .input-bar { display: flex; padding: 15px; border-top: 1px solid #ccc; background: #faf7f0; }
    .input-bar input { flex: 1; padding: 10px; border: 1px solid #ccc; border-radius: 8px; margin-right: 10px; }
    .input-bar button { padding: 10px 15px; border: none; border-radius: 8px; cursor: pointer; background: #d2b48c; color: white; }
    .input-bar button:hover { background: #a8875b; }
  </style>
</head>
<body>

<div class="sidebar">
  <h2>Menu</h2>
  <button onclick="newChat()">â• New Chat</button>
  <button onclick="loadDrive()">ğŸ“‚ Google Drive</button>
  <button onclick="loadProjects()">ğŸ— Projects</button>
  <button onclick="loadFolders()">ğŸ“Š Folders</button>
  <button onclick="openSettings()">âš™ï¸ Settings</button>
</div>

<div class="chat-area">
  <div class="chat-header">Diriyah Brain AI</div>
  <div class="messages" id="chatMessages"></div>
  <div class="input-bar">
    <input type="text" id="chatInput" placeholder="Ask something...">
    <button onclick="sendMessage()">Send</button>
  </div>
</div>

<script>
// Append message bubble to chat
function appendMessage(sender, text) {
  const chatBox = document.getElementById("chatMessages");
  const div = document.createElement("div");
  div.className = sender === "user" ? "bubble user-bubble" : "bubble ai-bubble";
  div.innerText = text;
  chatBox.appendChild(div);
  chatBox.scrollTop = chatBox.scrollHeight;
}

async function sendMessage() {
  const input = document.getElementById("chatInput").value.trim();
  if (!input) return;
  appendMessage("user", input);

  // Smart routing
  if (input.toLowerCase().startsWith("search drive")) {
    const q = input.replace(/search drive/i, "").trim();
    await searchDrive(q);
  } else if (input.toLowerCase().includes("list projects")) {
    await loadProjects();
  } else if (input.toLowerCase().includes("list folders")) {
    await loadFolders();
  } else {
    await askAI(input);
  }

  document.getElementById("chatInput").value = "";
}

async function askAI(query) {
  const formData = new FormData();
  formData.append("query", query);
  const res = await fetch("/ai/query", { method: "POST", body: formData });
  const data = await res.json();
  appendMessage("ai", data.reply);
}

async function loadProjects() {
  const res = await fetch("/projects");
  const data = await res.json();
  appendMessage("ai", "Projects:\n" + data.projects.map(p => p.name).join(", "));
}

async function loadFolders() {
  const res = await fetch("/folders");
  const data = await res.json();
  appendMessage("ai", "Folders:\n" + JSON.stringify(data.folders, null, 2));
}

async function loadDrive() {
  const res = await fetch("/drive/files");
  const data = await res.json();
  if (data.error) {
    appendMessage("ai", data.error);
  } else {
    appendMessage("ai", "Google Drive Files:\n" + data.map(f => f.name).join("\\n"));
  }
}

async function searchDrive(q) {
  const res = await fetch(`/drive/search?q=${encodeURIComponent(q)}`);
  const data = await res.json();
  if (data.error) {
    appendMessage("ai", data.error);
  } else if (data.length === 0) {
    appendMessage("ai", "No files found for: " + q);
  } else {
    appendMessage("ai", "Search Results:\n" + data.map(f => f.name).join("\\n"));
  }
}

function newChat() {
  document.getElementById("chatMessages").innerHTML = "";
  appendMessage("ai", "New chat started.");
}

function openSettings() {
  appendMessage("ai", "Settings: Manage tokens and API keys via /set-tokens.");
}
</script>

</body>
</html>
